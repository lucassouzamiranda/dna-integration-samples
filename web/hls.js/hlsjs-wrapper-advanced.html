<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Hls.js DNA Wrapper - Advanced</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
    </style>
    <link rel="stylesheet" href="//samples.streamroot.io/web/assets/demo-pages.css">

    <!-- Makes the header -->
    <script src="//samples.streamroot.io/web/assets/header.js"></script>

    <!-- Builds -->
    <script src="//cdn.jsdelivr.net/npm/hls.js@0.9.1/dist/hls.min.js"></script>
    <script src="//cdn.streamroot.io/hlsjs-dna-wrapper/1/stable/hlsjs-dna-wrapper.js"></script>

    <!-- Graphs -->
    <script src="//tools.streamroot.io/usage-graphs/stable/graphs.js"></script>
</head>

<body>
    <header></header>
    <center>
        <select id="streamList" style="width: 50%;">
            <option value="" selected>Select a test-stream.</option>
        </select>
        <p></p>
        <video id="demoplayer" width="512" height="288" muted controls autoplay></video>
        <div id="streamroot-graphs"></div>
    </center>

    <script>
        // NOTE: Content URLs here
        var contentUrls = {
            "Multi Bitrate 5Levels Live (BBB)": "http://wowza-test.streamroot.io/liveOriginTimestamps/bbb_30fps_live_5levels.smil/playlist.m3u8",
            "Multi Bitrate Live (Sintel)": "http://wowza-test.streamroot.io/liveOrigin/Sintel1/playlist.m3u8",
            "Multi Bitrate VoD (ToS)": "http://wowza-test.streamroot.io/liveOrigin/sintel-live.smil/playlist.m3u8"
        };

        var hlsjsConfig = {
            "maxBufferSize": 0,
            "maxBufferLength": 30,
            "liveSyncDuration": 30
        };
        var dnaConfig = {};

        window.addEventListener("DOMContentLoaded", function () {
            // Populate the stream list
            var streamKeys = Object.keys(contentUrls);
            var streamSelect = document.querySelector("#streamList");
            for (var i = 0; i < streamKeys.length; i++) {
                var option = document.createElement("option");
                option.text = streamKeys[i];
                streamSelect.add(option);
            }
            streamSelect.addEventListener("change", function () {
                switchStream(streamSelect.selectedIndex);
            });

            // NOTE: Initialize media engine and wrapper *here*
            // var hls = new Hls(hlsjsConfig);
            // var wrapper = new HlsjsDnaWrapper(hls, "demoswebsiteandpartners", dnaConfig);
            // var videoElement = document.getElementById('demoplayer');
            // hls.loadSource('https://wowza-test-cloudfront.streamroot.io/vodOrigin/tos1500.mp4/playlist.m3u8');
            // hls.attachMedia(videoElement);
            // hls.on(Hls.Events.MANIFEST_PARSED, function () {
            //     videoElement.play();
            // });
        });

        function switchStream(id) {
            var streamUrl = contentUrls[Object.keys(contentUrls)[id]];

            // NOTE: Replace with the proper stream switching logic for your ME/player *here*
            if (hls) {
                hls.destroy();
                if (hls.bufferTimer) {
                    clearInterval(hls.bufferTimer);
                    hls.bufferTimer = undefined;
                }
                hls = null;
            };

            var hlsjsConfig = {
                "maxBufferSize": 0,
                "maxBufferLength": 30,
                "liveSyncDuration": 30
            };
            
            var dnaConfig = {};
            var hls = new Hls(hlsjsConfig);
            var wrapper = new HlsjsDnaWrapper(hls, "demoswebsiteandpartners", dnaConfig);
            var videoElement = document.getElementById('demoplayer');
            hls.loadSource(streamUrl);
            hls.attachMedia(videoElement);
            hls.on(Hls.Events.MANIFEST_PARSED, function () {
                videoElement.play();
            });
        }
    </script>
</body>

</html>